#version 330

// Input vertex attributes (from vertex shader)
in vec2 fragTexCoord;
in vec4 fragColor;

// Input uniform values
uniform sampler2D texture0;
uniform vec4 colDiffuse;

// Output fragment color
out vec4 finalColor;

vec4 palette[244] = vec4[244] (
    vec4( 0.0 ,  0.0 ,  0.0 , 1),
    vec4( 0.058823529411764705 ,  0.058823529411764705 ,  0.058823529411764705 , 1),
    vec4( 0.12156862745098039 ,  0.12156862745098039 ,  0.12156862745098039 , 1),
    vec4( 0.1843137254901961 ,  0.1843137254901961 ,  0.1843137254901961 , 1),
    vec4( 0.24705882352941178 ,  0.24705882352941178 ,  0.24705882352941178 , 1),
    vec4( 0.29411764705882354 ,  0.29411764705882354 ,  0.29411764705882354 , 1),
    vec4( 0.3568627450980392 ,  0.3568627450980392 ,  0.3568627450980392 , 1),
    vec4( 0.4196078431372549 ,  0.4196078431372549 ,  0.4196078431372549 , 1),
    vec4( 0.4823529411764706 ,  0.4823529411764706 ,  0.4823529411764706 , 1),
    vec4( 0.5450980392156862 ,  0.5450980392156862 ,  0.5450980392156862 , 1),
    vec4( 0.6078431372549019 ,  0.6078431372549019 ,  0.6078431372549019 , 1),
    vec4( 0.6705882352941176 ,  0.6705882352941176 ,  0.6705882352941176 , 1),
    vec4( 0.7333333333333333 ,  0.7333333333333333 ,  0.7333333333333333 , 1),
    vec4( 0.796078431372549 ,  0.796078431372549 ,  0.796078431372549 , 1),
    vec4( 0.8588235294117647 ,  0.8588235294117647 ,  0.8588235294117647 , 1),
    vec4( 0.9215686274509803 ,  0.9215686274509803 ,  0.9215686274509803 , 1),
    vec4( 0.058823529411764705 ,  0.043137254901960784 ,  0.027450980392156862 , 1),
    vec4( 0.09019607843137255 ,  0.058823529411764705 ,  0.043137254901960784 , 1),
    vec4( 0.12156862745098039 ,  0.09019607843137255 ,  0.043137254901960784 , 1),
    vec4( 0.15294117647058825 ,  0.10588235294117647 ,  0.058823529411764705 , 1),
    vec4( 0.1843137254901961 ,  0.13725490196078433 ,  0.07450980392156863 , 1),
    vec4( 0.21568627450980393 ,  0.16862745098039217 ,  0.09019607843137255 , 1),
    vec4( 0.24705882352941178 ,  0.1843137254901961 ,  0.09019607843137255 , 1),
    vec4( 0.29411764705882354 ,  0.21568627450980393 ,  0.10588235294117647 , 1),
    vec4( 0.3254901960784314 ,  0.23137254901960785 ,  0.10588235294117647 , 1),
    vec4( 0.3568627450980392 ,  0.2627450980392157 ,  0.12156862745098039 , 1),
    vec4( 0.38823529411764707 ,  0.29411764705882354 ,  0.12156862745098039 , 1),
    vec4( 0.4196078431372549 ,  0.3254901960784314 ,  0.12156862745098039 , 1),
    vec4( 0.45098039215686275 ,  0.3411764705882353 ,  0.12156862745098039 , 1),
    vec4( 0.4823529411764706 ,  0.37254901960784315 ,  0.13725490196078433 , 1),
    vec4( 0.5137254901960784 ,  0.403921568627451 ,  0.13725490196078433 , 1),
    vec4( 0.5607843137254902 ,  0.43529411764705883 ,  0.13725490196078433 , 1),
    vec4( 0.043137254901960784 ,  0.043137254901960784 ,  0.058823529411764705 , 1),
    vec4( 0.07450980392156863 ,  0.07450980392156863 ,  0.10588235294117647 , 1),
    vec4( 0.10588235294117647 ,  0.10588235294117647 ,  0.15294117647058825 , 1),
    vec4( 0.15294117647058825 ,  0.15294117647058825 ,  0.2 , 1),
    vec4( 0.1843137254901961 ,  0.1843137254901961 ,  0.24705882352941178 , 1),
    vec4( 0.21568627450980393 ,  0.21568627450980393 ,  0.29411764705882354 , 1),
    vec4( 0.24705882352941178 ,  0.24705882352941178 ,  0.3411764705882353 , 1),
    vec4( 0.2784313725490196 ,  0.2784313725490196 ,  0.403921568627451 , 1),
    vec4( 0.30980392156862746 ,  0.30980392156862746 ,  0.45098039215686275 , 1),
    vec4( 0.3568627450980392 ,  0.3568627450980392 ,  0.4980392156862745 , 1),
    vec4( 0.38823529411764707 ,  0.38823529411764707 ,  0.5450980392156862 , 1),
    vec4( 0.4196078431372549 ,  0.4196078431372549 ,  0.592156862745098 , 1),
    vec4( 0.45098039215686275 ,  0.45098039215686275 ,  0.6392156862745098 , 1),
    vec4( 0.4823529411764706 ,  0.4823529411764706 ,  0.6862745098039216 , 1),
    vec4( 0.5137254901960784 ,  0.5137254901960784 ,  0.7333333333333333 , 1),
    vec4( 0.5450980392156862 ,  0.5450980392156862 ,  0.796078431372549 , 1),
    vec4( 0.027450980392156862 ,  0.027450980392156862 ,  0.0 , 1),
    vec4( 0.043137254901960784 ,  0.043137254901960784 ,  0.0 , 1),
    vec4( 0.07450980392156863 ,  0.07450980392156863 ,  0.0 , 1),
    vec4( 0.10588235294117647 ,  0.10588235294117647 ,  0.0 , 1),
    vec4( 0.13725490196078433 ,  0.13725490196078433 ,  0.0 , 1),
    vec4( 0.16862745098039217 ,  0.16862745098039217 ,  0.027450980392156862 , 1),
    vec4( 0.1843137254901961 ,  0.1843137254901961 ,  0.027450980392156862 , 1),
    vec4( 0.21568627450980393 ,  0.21568627450980393 ,  0.027450980392156862 , 1),
    vec4( 0.24705882352941178 ,  0.24705882352941178 ,  0.027450980392156862 , 1),
    vec4( 0.2784313725490196 ,  0.2784313725490196 ,  0.027450980392156862 , 1),
    vec4( 0.29411764705882354 ,  0.29411764705882354 ,  0.043137254901960784 , 1),
    vec4( 0.3254901960784314 ,  0.3254901960784314 ,  0.043137254901960784 , 1),
    vec4( 0.3568627450980392 ,  0.3568627450980392 ,  0.043137254901960784 , 1),
    vec4( 0.38823529411764707 ,  0.38823529411764707 ,  0.043137254901960784 , 1),
    vec4( 0.4196078431372549 ,  0.4196078431372549 ,  0.058823529411764705 , 1),
    vec4( 0.027450980392156862 ,  0.0 ,  0.0 , 1),
    vec4( 0.058823529411764705 ,  0.0 ,  0.0 , 1),
    vec4( 0.09019607843137255 ,  0.0 ,  0.0 , 1),
    vec4( 0.12156862745098039 ,  0.0 ,  0.0 , 1),
    vec4( 0.15294117647058825 ,  0.0 ,  0.0 , 1),
    vec4( 0.1843137254901961 ,  0.0 ,  0.0 , 1),
    vec4( 0.21568627450980393 ,  0.0 ,  0.0 , 1),
    vec4( 0.24705882352941178 ,  0.0 ,  0.0 , 1),
    vec4( 0.2784313725490196 ,  0.0 ,  0.0 , 1),
    vec4( 0.30980392156862746 ,  0.0 ,  0.0 , 1),
    vec4( 0.3411764705882353 ,  0.0 ,  0.0 , 1),
    vec4( 0.37254901960784315 ,  0.0 ,  0.0 , 1),
    vec4( 0.403921568627451 ,  0.0 ,  0.0 , 1),
    vec4( 0.43529411764705883 ,  0.0 ,  0.0 , 1),
    vec4( 0.4666666666666667 ,  0.0 ,  0.0 , 1),
    vec4( 0.4980392156862745 ,  0.0 ,  0.0 , 1),
    vec4( 0.1843137254901961 ,  0.16862745098039217 ,  0.0 , 1),
    vec4( 0.21568627450980393 ,  0.1843137254901961 ,  0.0 , 1),
    vec4( 0.2627450980392157 ,  0.21568627450980393 ,  0.0 , 1),
    vec4( 0.29411764705882354 ,  0.23137254901960785 ,  0.027450980392156862 , 1),
    vec4( 0.3411764705882353 ,  0.2627450980392157 ,  0.027450980392156862 , 1),
    vec4( 0.37254901960784315 ,  0.2784313725490196 ,  0.027450980392156862 , 1),
    vec4( 0.4196078431372549 ,  0.29411764705882354 ,  0.043137254901960784 , 1),
    vec4( 0.4666666666666667 ,  0.3254901960784314 ,  0.058823529411764705 , 1),
    vec4( 0.5137254901960784 ,  0.3411764705882353 ,  0.07450980392156863 , 1),
    vec4( 0.5450980392156862 ,  0.3568627450980392 ,  0.07450980392156863 , 1),
    vec4( 0.592156862745098 ,  0.37254901960784315 ,  0.10588235294117647 , 1),
    vec4( 0.6392156862745098 ,  0.38823529411764707 ,  0.12156862745098039 , 1),
    vec4( 0.6862745098039216 ,  0.403921568627451 ,  0.13725490196078433 , 1),
    vec4( 0.13725490196078433 ,  0.07450980392156863 ,  0.027450980392156862 , 1),
    vec4( 0.1843137254901961 ,  0.09019607843137255 ,  0.043137254901960784 , 1),
    vec4( 0.23137254901960785 ,  0.12156862745098039 ,  0.058823529411764705 , 1),
    vec4( 0.29411764705882354 ,  0.13725490196078433 ,  0.07450980392156863 , 1),
    vec4( 0.3411764705882353 ,  0.16862745098039217 ,  0.09019607843137255 , 1),
    vec4( 0.38823529411764707 ,  0.1843137254901961 ,  0.12156862745098039 , 1),
    vec4( 0.45098039215686275 ,  0.21568627450980393 ,  0.13725490196078433 , 1),
    vec4( 0.4980392156862745 ,  0.23137254901960785 ,  0.16862745098039217 , 1),
    vec4( 0.5607843137254902 ,  0.2627450980392157 ,  0.2 , 1),
    vec4( 0.6235294117647059 ,  0.30980392156862746 ,  0.2 , 1),
    vec4( 0.6862745098039216 ,  0.38823529411764707 ,  0.1843137254901961 , 1),
    vec4( 0.7490196078431373 ,  0.4666666666666667 ,  0.1843137254901961 , 1),
    vec4( 0.8117647058823529 ,  0.5607843137254902 ,  0.16862745098039217 , 1),
    vec4( 0.8745098039215686 ,  0.6705882352941176 ,  0.15294117647058825 , 1),
    vec4( 0.9372549019607843 ,  0.796078431372549 ,  0.12156862745098039 , 1),
    vec4( 1.0 ,  0.9529411764705882 ,  0.10588235294117647 , 1),
    vec4( 0.043137254901960784 ,  0.027450980392156862 ,  0.0 , 1),
    vec4( 0.10588235294117647 ,  0.07450980392156863 ,  0.0 , 1),
    vec4( 0.16862745098039217 ,  0.13725490196078433 ,  0.058823529411764705 , 1),
    vec4( 0.21568627450980393 ,  0.16862745098039217 ,  0.07450980392156863 , 1),
    vec4( 0.2784313725490196 ,  0.2 ,  0.10588235294117647 , 1),
    vec4( 0.3254901960784314 ,  0.21568627450980393 ,  0.13725490196078433 , 1),
    vec4( 0.38823529411764707 ,  0.24705882352941178 ,  0.16862745098039217 , 1),
    vec4( 0.43529411764705883 ,  0.2784313725490196 ,  0.2 , 1),
    vec4( 0.4980392156862745 ,  0.3254901960784314 ,  0.24705882352941178 , 1),
    vec4( 0.5450980392156862 ,  0.37254901960784315 ,  0.2784313725490196 , 1),
    vec4( 0.6078431372549019 ,  0.4196078431372549 ,  0.3254901960784314 , 1),
    vec4( 0.6549019607843137 ,  0.4823529411764706 ,  0.37254901960784315 , 1),
    vec4( 0.7176470588235294 ,  0.5294117647058824 ,  0.4196078431372549 , 1),
    vec4( 0.7647058823529411 ,  0.5764705882352941 ,  0.4823529411764706 , 1),
    vec4( 0.8274509803921568 ,  0.6392156862745098 ,  0.5450980392156862 , 1),
    vec4( 0.8901960784313725 ,  0.7019607843137254 ,  0.592156862745098 , 1),
    vec4( 0.6705882352941176 ,  0.5450980392156862 ,  0.6392156862745098 , 1),
    vec4( 0.6235294117647059 ,  0.4980392156862745 ,  0.592156862745098 , 1),
    vec4( 0.5764705882352941 ,  0.45098039215686275 ,  0.5294117647058824 , 1),
    vec4( 0.5450980392156862 ,  0.403921568627451 ,  0.4823529411764706 , 1),
    vec4( 0.4980392156862745 ,  0.3568627450980392 ,  0.43529411764705883 , 1),
    vec4( 0.4666666666666667 ,  0.3254901960784314 ,  0.38823529411764707 , 1),
    vec4( 0.4196078431372549 ,  0.29411764705882354 ,  0.3411764705882353 , 1),
    vec4( 0.37254901960784315 ,  0.24705882352941178 ,  0.29411764705882354 , 1),
    vec4( 0.3411764705882353 ,  0.21568627450980393 ,  0.2627450980392157 , 1),
    vec4( 0.29411764705882354 ,  0.1843137254901961 ,  0.21568627450980393 , 1),
    vec4( 0.2627450980392157 ,  0.15294117647058825 ,  0.1843137254901961 , 1),
    vec4( 0.21568627450980393 ,  0.12156862745098039 ,  0.13725490196078433 , 1),
    vec4( 0.16862745098039217 ,  0.09019607843137255 ,  0.10588235294117647 , 1),
    vec4( 0.13725490196078433 ,  0.07450980392156863 ,  0.07450980392156863 , 1),
    vec4( 0.09019607843137255 ,  0.043137254901960784 ,  0.043137254901960784 , 1),
    vec4( 0.058823529411764705 ,  0.027450980392156862 ,  0.027450980392156862 , 1),
    vec4( 0.7333333333333333 ,  0.45098039215686275 ,  0.6235294117647059 , 1),
    vec4( 0.6862745098039216 ,  0.4196078431372549 ,  0.5607843137254902 , 1),
    vec4( 0.6392156862745098 ,  0.37254901960784315 ,  0.5137254901960784 , 1),
    vec4( 0.592156862745098 ,  0.3411764705882353 ,  0.4666666666666667 , 1),
    vec4( 0.5450980392156862 ,  0.30980392156862746 ,  0.4196078431372549 , 1),
    vec4( 0.4980392156862745 ,  0.29411764705882354 ,  0.37254901960784315 , 1),
    vec4( 0.45098039215686275 ,  0.2627450980392157 ,  0.3254901960784314 , 1),
    vec4( 0.4196078431372549 ,  0.23137254901960785 ,  0.29411764705882354 , 1),
    vec4( 0.37254901960784315 ,  0.2 ,  0.24705882352941178 , 1),
    vec4( 0.3254901960784314 ,  0.16862745098039217 ,  0.21568627450980393 , 1),
    vec4( 0.2784313725490196 ,  0.13725490196078433 ,  0.16862745098039217 , 1),
    vec4( 0.23137254901960785 ,  0.12156862745098039 ,  0.13725490196078433 , 1),
    vec4( 0.1843137254901961 ,  0.09019607843137255 ,  0.10588235294117647 , 1),
    vec4( 0.8588235294117647 ,  0.7647058823529411 ,  0.7333333333333333 , 1),
    vec4( 0.796078431372549 ,  0.7019607843137254 ,  0.6549019607843137 , 1),
    vec4( 0.7490196078431373 ,  0.6392156862745098 ,  0.6078431372549019 , 1),
    vec4( 0.6862745098039216 ,  0.592156862745098 ,  0.5450980392156862 , 1),
    vec4( 0.6392156862745098 ,  0.5294117647058824 ,  0.4823529411764706 , 1),
    vec4( 0.592156862745098 ,  0.4823529411764706 ,  0.43529411764705883 , 1),
    vec4( 0.5294117647058824 ,  0.43529411764705883 ,  0.37254901960784315 , 1),
    vec4( 0.4823529411764706 ,  0.38823529411764707 ,  0.3254901960784314 , 1),
    vec4( 0.4196078431372549 ,  0.3411764705882353 ,  0.2784313725490196 , 1),
    vec4( 0.37254901960784315 ,  0.29411764705882354 ,  0.23137254901960785 , 1),
    vec4( 0.3254901960784314 ,  0.24705882352941178 ,  0.2 , 1),
    vec4( 0.2627450980392157 ,  0.2 ,  0.15294117647058825 , 1),
    vec4( 0.21568627450980393 ,  0.16862745098039217 ,  0.12156862745098039 , 1),
    vec4( 0.15294117647058825 ,  0.12156862745098039 ,  0.09019607843137255 , 1),
    vec4( 0.10588235294117647 ,  0.07450980392156863 ,  0.058823529411764705 , 1),
    vec4( 0.43529411764705883 ,  0.5137254901960784 ,  0.4823529411764706 , 1),
    vec4( 0.403921568627451 ,  0.4823529411764706 ,  0.43529411764705883 , 1),
    vec4( 0.37254901960784315 ,  0.45098039215686275 ,  0.403921568627451 , 1),
    vec4( 0.3411764705882353 ,  0.4196078431372549 ,  0.37254901960784315 , 1),
    vec4( 0.30980392156862746 ,  0.38823529411764707 ,  0.3411764705882353 , 1),
    vec4( 0.2784313725490196 ,  0.3568627450980392 ,  0.30980392156862746 , 1),
    vec4( 0.24705882352941178 ,  0.3254901960784314 ,  0.2784313725490196 , 1),
    vec4( 0.21568627450980393 ,  0.29411764705882354 ,  0.24705882352941178 , 1),
    vec4( 0.1843137254901961 ,  0.2627450980392157 ,  0.21568627450980393 , 1),
    vec4( 0.16862745098039217 ,  0.23137254901960785 ,  0.1843137254901961 , 1),
    vec4( 0.13725490196078433 ,  0.2 ,  0.15294117647058825 , 1),
    vec4( 0.12156862745098039 ,  0.16862745098039217 ,  0.12156862745098039 , 1),
    vec4( 0.09019607843137255 ,  0.13725490196078433 ,  0.09019607843137255 , 1),
    vec4( 0.058823529411764705 ,  0.10588235294117647 ,  0.07450980392156863 , 1),
    vec4( 0.043137254901960784 ,  0.07450980392156863 ,  0.043137254901960784 , 1),
    vec4( 0.027450980392156862 ,  0.043137254901960784 ,  0.027450980392156862 , 1),
    vec4( 0.9372549019607843 ,  0.8745098039215686 ,  0.09019607843137255 , 1),
    vec4( 0.8588235294117647 ,  0.796078431372549 ,  0.07450980392156863 , 1),
    vec4( 0.796078431372549 ,  0.7176470588235294 ,  0.058823529411764705 , 1),
    vec4( 0.7333333333333333 ,  0.6549019607843137 ,  0.058823529411764705 , 1),
    vec4( 0.6705882352941176 ,  0.592156862745098 ,  0.043137254901960784 , 1),
    vec4( 0.6078431372549019 ,  0.5137254901960784 ,  0.027450980392156862 , 1),
    vec4( 0.5450980392156862 ,  0.45098039215686275 ,  0.027450980392156862 , 1),
    vec4( 0.4823529411764706 ,  0.38823529411764707 ,  0.027450980392156862 , 1),
    vec4( 0.4196078431372549 ,  0.3254901960784314 ,  0.0 , 1),
    vec4( 0.3568627450980392 ,  0.2784313725490196 ,  0.0 , 1),
    vec4( 0.29411764705882354 ,  0.21568627450980393 ,  0.0 , 1),
    vec4( 0.23137254901960785 ,  0.16862745098039217 ,  0.0 , 1),
    vec4( 0.16862745098039217 ,  0.12156862745098039 ,  0.0 , 1),
    vec4( 0.10588235294117647 ,  0.058823529411764705 ,  0.0 , 1),
    vec4( 0.0 ,  0.0 ,  1.0 , 1),
    vec4( 0.043137254901960784 ,  0.043137254901960784 ,  0.9372549019607843 , 1),
    vec4( 0.07450980392156863 ,  0.07450980392156863 ,  0.8745098039215686 , 1),
    vec4( 0.10588235294117647 ,  0.10588235294117647 ,  0.8117647058823529 , 1),
    vec4( 0.13725490196078433 ,  0.13725490196078433 ,  0.7490196078431373 , 1),
    vec4( 0.16862745098039217 ,  0.16862745098039217 ,  0.6862745098039216 , 1),
    vec4( 0.1843137254901961 ,  0.1843137254901961 ,  0.6235294117647059 , 1),
    vec4( 0.1843137254901961 ,  0.1843137254901961 ,  0.5607843137254902 , 1),
    vec4( 0.1843137254901961 ,  0.1843137254901961 ,  0.4980392156862745 , 1),
    vec4( 0.1843137254901961 ,  0.1843137254901961 ,  0.43529411764705883 , 1),
    vec4( 0.1843137254901961 ,  0.1843137254901961 ,  0.37254901960784315 , 1),
    vec4( 0.16862745098039217 ,  0.16862745098039217 ,  0.30980392156862746 , 1),
    vec4( 0.13725490196078433 ,  0.13725490196078433 ,  0.24705882352941178 , 1),
    vec4( 0.10588235294117647 ,  0.10588235294117647 ,  0.1843137254901961 , 1),
    vec4( 0.07450980392156863 ,  0.07450980392156863 ,  0.12156862745098039 , 1),
    vec4( 0.16862745098039217 ,  0.0 ,  0.0 , 1),
    vec4( 0.23137254901960785 ,  0.0 ,  0.0 , 1),
    vec4( 0.29411764705882354 ,  0.027450980392156862 ,  0.0 , 1),
    vec4( 0.37254901960784315 ,  0.027450980392156862 ,  0.0 , 1),
    vec4( 0.43529411764705883 ,  0.058823529411764705 ,  0.0 , 1),
    vec4( 0.4980392156862745 ,  0.09019607843137255 ,  0.027450980392156862 , 1),
    vec4( 0.5764705882352941 ,  0.12156862745098039 ,  0.027450980392156862 , 1),
    vec4( 0.6392156862745098 ,  0.15294117647058825 ,  0.043137254901960784 , 1),
    vec4( 0.7176470588235294 ,  0.2 ,  0.058823529411764705 , 1),
    vec4( 0.7647058823529411 ,  0.29411764705882354 ,  0.10588235294117647 , 1),
    vec4( 0.8117647058823529 ,  0.38823529411764707 ,  0.16862745098039217 , 1),
    vec4( 0.8588235294117647 ,  0.4980392156862745 ,  0.23137254901960785 , 1),
    vec4( 0.8901960784313725 ,  0.592156862745098 ,  0.30980392156862746 , 1),
    vec4( 0.9058823529411765 ,  0.6705882352941176 ,  0.37254901960784315 , 1),
    vec4( 0.9372549019607843 ,  0.7490196078431373 ,  0.4666666666666667 , 1),
    vec4( 0.9686274509803922 ,  0.8274509803921568 ,  0.5450980392156862 , 1),
    vec4( 0.6549019607843137 ,  0.4823529411764706 ,  0.23137254901960785 , 1),
    vec4( 0.7176470588235294 ,  0.6078431372549019 ,  0.21568627450980393 , 1),
    vec4( 0.7803921568627451 ,  0.7647058823529411 ,  0.21568627450980393 , 1),
    vec4( 0.9058823529411765 ,  0.8901960784313725 ,  0.3411764705882353 , 1),
    vec4( 0.4980392156862745 ,  0.7490196078431373 ,  1.0 , 1),
    vec4( 0.6705882352941176 ,  0.9058823529411765 ,  1.0 , 1),
    vec4( 0.8431372549019608 ,  1.0 ,  1.0 , 1),
    vec4( 0.5450980392156862 ,  0.0 ,  0.0 , 1),
    vec4( 0.7019607843137254 ,  0.0 ,  0.0 , 1),
    vec4( 0.8431372549019608 ,  0.0 ,  0.0 , 1),
    vec4( 1.0 ,  0.0 ,  0.0 , 1),
    vec4( 1.0 ,  0.9529411764705882 ,  0.5764705882352941 , 1),
    vec4( 1.0 ,  0.9686274509803922 ,  0.7803921568627451 , 1),
    vec4( 1.0 ,  1.0 ,  1.0 , 1),
    vec4( 0.6235294117647059 ,  0.3568627450980392 ,  0.3254901960784314 , 1)
);


float colorDistance(vec4 color1, vec4 color2)
{
    return sqrt(
        (color1.r - color2.r) * (color1.r - color2.r) +
        (color1.g - color2.g) * (color1.g - color2.g) +
        (color1.b - color2.b) * (color1.b - color2.b) +
        (color1.a - color2.a) * (color1.a - color2.a)
    );
}

void main()
{
    vec4 texelColor = texture(texture0, fragTexCoord)*colDiffuse*fragColor;
    finalColor = texelColor;

    // Find color in palette to avoid distance computations
    bool found = false;
    vec4 texelColorRounded = texelColor;
    texelColorRounded.r -= texelColorRounded.r % 0.01;
    texelColorRounded.g -= texelColorRounded.g % 0.01;
    texelColorRounded.b -= texelColorRounded.b % 0.01;

    for (int i = 0; i < palette.length; i++)
    {
        vec4 paletteColor = palette[i];

        paletteColor.r -= paletteColor.r %0.01;
        paletteColor.g -= paletteColor.g %0.01;
        paletteColor.b -= paletteColor.b %0.01;

        if (paletteColor.r == texelColorRounded &&
            paletteColor.g == texelColorRounded &&
            paletteColor.b == texelColorRounded)
        {
            finalColor = palette[i];
            found = true;
            break;
        }
    }

    // If didn't find, find closest color in palette    
    if (!found) 
    {
        vec4 closestColor = palette[0];
        float prevDistance = 10;

        for (int i = 0; i < palette.length; i++)
        {
            vec4 paletteColor = palette[i];
            float dist = colorDistance(paletteColor, finalColor);

            if (dist < prevDistance)
            {
                prevDistance = dist;
                closestColor = paletteColor;
            }
        }
        
        finalColor = closestColor;
    }
}